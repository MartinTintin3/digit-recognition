(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"1fKG":function(e,t){e.exports=ReduxSaga},"65Xs":function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return s});const i={ADD_STROKE:"ADD_STROKE",ADD_STROKE_POS:"ADD_STROKE_POS",END_STROKE:"END_STROKE",RESET_DRAWING:"RESET_DRAWING"},r=e=>({type:i.ADD_STROKE,pos:e}),o=e=>({type:i.ADD_STROKE_POS,pos:e}),a=()=>({type:i.END_STROKE}),s=()=>({type:i.RESET_DRAWING})},"7pVq":function(e,t,n){"use strict";n.r(t);n("cDcd");var i=n("faye"),r=n.n(i),o=n("pL5B"),a=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();r.a.render(a(o.a,{}),document.getElementById("app"))},"8XyM":function(e,t,n){"use strict";n("M7k7");var i=n("Ol7k"),r=n("cDcd"),o=n.n(r),a=(n("Jmwx"),n("BMrR")),s=n("Dtiu"),c=n.n(s),l=n("h74D"),d=n("Re2a"),u=(n("04bd"),n("W9HT")),h=(n("17x9"),n("65Xs")),f=n("s5aF"),p=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();const y=c.a.canvas.withConfig({displayName:"drawing__Canvas"})(["width:300px;height:300px;border-color:dodgerblue;border-width:5px;border-style:solid;display:block;touch-action:none;&:hover{border-color:deepskyblue;}"]);var m=Object(l.connect)(e=>({isDrawing:e.drawing.isDrawing,isEndStroke:e.drawing.isEndStroke,strokes:e.drawing.strokes}),e=>({addStroke:t=>e(Object(h.b)(t)),addStrokePos:t=>e(Object(h.c)(t)),endStroke:()=>e(Object(h.d)()),addInput:t=>e(Object(f.b)(t))}))(class extends o.a.Component{constructor(e){super(e),this.onMouseDown=(e=>{const{addStroke:t}=this.props;t(this.computeMousePos(e))}),this.onMouseMove=(e=>{const{isDrawing:t,addStrokePos:n}=this.props;t&&n(this.computeMousePos(e))}),this.onStrokeEnd=(()=>{const{isDrawing:e,endStroke:t}=this.props;e&&t()}),this.setCanvasRef=(e=>{this.canvas=e}),this.canvas=null,this.ctx=null}componentDidMount(){this.initContext()}componentDidUpdate(){this.initContext(),this.drawStrokes();const{isEndStroke:e,addInput:t}=this.props;e&&t(this.ctx.getImageData(0,0,280,280))}initContext(){this.ctx=this.canvas.getContext("2d"),this.ctx.lineWidth=10,this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.strokeStyle="white",this.ctx.fillStyle="dark",this.clearCanvas()}clearCanvas(){this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}computeMousePos(e){return{x:this.computeMousePosX(e),y:this.computeMousePosY(e)}}computeMousePosX(e){const t=this.canvas.getBoundingClientRect(),n=this.canvas.width/t.width;return(e.clientX-t.left)*n}computeMousePosY(e){const t=this.canvas.getBoundingClientRect(),n=this.canvas.height/t.height;return(e.clientY-t.top)*n}drawStrokes(){const{strokes:e}=this.props;for(let t=0;t<e.length;t+=1){const n=e[t];this.ctx.beginPath(),this.ctx.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e+=1)this.ctx.lineTo(n[e].x,n[e].y);this.ctx.stroke()}}render(){return p("div",{"touch-action":"none"},void 0,p(y,{innerRef:this.setCanvasRef,onPointerDown:this.onMouseDown,onPointerMove:this.onMouseMove,onPointerUp:this.onStrokeEnd,onMouseLeave:this.onStrokeEnd,width:"280",height:"280"}))}}),v=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();const g=c.a.h2.withConfig({displayName:"output__H2"})(["text-align:center;"]);class _ extends o.a.PureComponent{render(){const{prediction:e}=this.props;return v(g,{},void 0,null!=e?`Prediction: ${e}`:"Draw a number (0-9) in the black box above")}}_.defaultProps={prediction:null};var S=Object(l.connect)(e=>({prediction:e.mnist.prediction}))(_),D=(n("rO+z"),n("kPKH"));var E=c()(D.a).withConfig({displayName:"center-col__CenterCol"})(["display:flex;align-items:center;justify-content:center;"]),b=(n("L/Qf"),n("2/Rp"));var I=c()(b.a).withConfig({displayName:"button-space__ButtonSpace"})(["margin:0 2px;"]);var O=Object(l.connect)(e=>({disabled:null==e.mnist.prediction}),e=>({onClick:()=>e(Object(h.e)())}))(I),w=(n("k994"),n("NJEC"));function T(e){return e.mnist.retrainStatus!==d.a.INIT&&e.mnist.retrainStatus!==d.a.LOAD_AND_TRAIN_MNIST_SUCCEEDED}var x=Object(l.connect)(e=>({loading:T(e),disabled:null==e.mnist.prediction,children:(e=>{switch(e.mnist.retrainStatus){case d.a.LOADING_MNIST:return"Loading MNIST database";case d.a.TRAINING_MNIST:return"Training new model";default:return"Retrain model"}})(e)}),()=>({}))(I),C=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();const A=c.a.p.withConfig({displayName:"confirm-retrain-button__PWarning"})(["color:red;"]),N=C("div",{},void 0,C("p",{},void 0,"The system has already loaded a pretrained model with 0.99700 accuracy. If you want to train a new model, please click on continue button."),C(A,{},void 0,"It is unrecommended to run the training on your phone. The process will drain your battery."));var R=C(x,{});var P=({onConfirm:e})=>C(w.a,{title:N,trigger:"click",okText:"Continue",onConfirm:e},void 0,R);var j=Object(l.connect)(null,e=>({onConfirm:()=>e(Object(d.b)())}))(P),k=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}(),L=k("div",{},void 0,k(O,{},void 0,"Clear"),k(j,{}));var M=()=>L,U=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}(),B=U(E,{xs:24},void 0,U(m,{})),$=U(E,{xs:24},void 0,U(S,{})),z=U(E,{xs:24},void 0,U(M,{}));const X=({spinning:e})=>U(u.a,{spinning:e},void 0,B,$,z);X.defaultProps={spinning:!0};var H=X;var G=Object(l.connect)(e=>({spinning:e.mnist.status===d.a.INIT||T(e)}))(H),F=n("HTZB"),Y=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();class K extends o.a.Component{static getObjectKeyName(e,t){return Object.keys(e)[t]}render(){const{data:e,cols:t}=this.props,n=K.getObjectKeyName(t,0),i=K.getObjectKeyName(t,1),r=`${n}*${i}`;return e.length>0?Y(F.Chart,{height:400,data:e,scale:t,padding:["auto","auto",40,"auto"],forceFit:!0},void 0,Y(F.Axis,{name:n,title:!0}),Y(F.Axis,{name:i,title:!0}),Y(F.Tooltip,{crosshairs:{type:"cross"}}),Y(F.Geom,{type:"line",position:r,size:2}),Y(F.Geom,{type:"point",position:r,size:4,shape:"circle",style:{stroke:"#fff",lineWidth:1}})):null}}K.defaultProps={data:null,cols:null};var W=Object(l.connect)(e=>({data:e.chart.accuracy,cols:{batch:{range:[0,1],alias:"Batch"},accuracy:{min:0,alias:"Accuracy"}}}))(K);var Q=Object(l.connect)(e=>({data:e.chart.loss,cols:{batch:{range:[0,1],alias:"Batch"},loss:{min:0,alias:"Loss"}}}))(K),Z=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}(),J=Z(a.a,{},void 0,Z(D.a,{md:12},void 0,Z(Q,{})),Z(D.a,{md:12},void 0,Z(W,{})));var q=()=>J,V=(n("QWBH"),function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}());const ee=c()(a.a).withConfig({displayName:"display__DisplayRow"})(["margin-bottom:10px;"]),te=c.a.h3.withConfig({displayName:"display__H3"})(["margin:0;"]),ne=c.a.canvas.withConfig({displayName:"display__Canvas"})(["display:block;"]);class ie extends o.a.Component{constructor(e){super(e),this.setCanvasRef=(e=>{this.canvas=e}),this.canvas=null,this.ctx=null}componentDidMount(){this.initContext()}componentDidUpdate(){this.initContext()}initContext(){this.ctx=this.canvas.getContext("2d"),this.clearCanvas(),this.loadImage()}clearCanvas(){this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}loadImage(){const{imageUrl:e}=this.props;if(e){const t=new Image;t.onload=(()=>{this.ctx.drawImage(t,0,0)}),t.src=e}}render(){const{className:e,width:t,height:n,title:i}=this.props;return V(ee,{},void 0,V(E,{span:24},void 0,V(te,{},void 0,i)),V(E,{span:24},void 0,V(ne,{innerRef:this.setCanvasRef,className:e,width:t,height:n})))}}ie.defaultProps={imageUrl:null,className:"",width:280,height:280};const re=c()(ie).withConfig({displayName:"display__Display140"})(["width:140px;height:140px;"]),oe=(c()(ie).withConfig({displayName:"display__Display200"})(["width:200px;height:200px;"]),c()(ie).withConfig({displayName:"display__Display100"})(["width:100px;height:100px;"])),ae=c()(ie).withConfig({displayName:"display__Display28"})(["width:28px;height:28px;"]);var se=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();class ce extends o.a.Component{constructor(...e){var t;return t=super(...e),this.setDisplay=(e=>{this.display=e}),t}componentDidMount(){this.initContext()}componentDidUpdate(){this.initContext()}initContext(){const{imageUrl:e,rect:t}=this.props;if(e){const n=new Image;n.onload=(()=>{this.display.ctx.drawImage(n,0,0),this.display.ctx.strokeStyle="red",this.display.ctx.strokeRect(t.xmin,t.ymin,t.computeWidth(),t.computeHeight())}),n.src=e}}render(){return se(re,{innerRef:this.setDisplay,title:"Bounding box"})}}ce.defaultProps={imageUrl:null,rect:null};var le=Object(l.connect)(e=>({imageUrl:e.pipeline.imageUrl,rect:e.pipeline.rect}))(ce);var de=Object(l.connect)(e=>({imageUrl:e.pipeline.centeredUrl,width:280,height:280,title:"Centered image"}))(re);var ue=Object(l.connect)(e=>({imageUrl:e.pipeline.croppedUrl,width:200,height:200,title:"Cropped image"}))(oe);var he=Object(l.connect)(e=>({imageUrl:e.pipeline.normalizedUrl,width:28,height:28,title:"Normalized image"}))(ae),fe=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();var pe=fe(c()(a.a).withConfig({displayName:"image-pipeline__ImagePipelineRow"})(["margin-top:20px;"]),{type:"flex",align:"middle"},void 0,fe(E,{xs:24,sm:12,md:6},void 0,fe(le,{})),fe(E,{xs:24,sm:12,md:6},void 0,fe(ue,{})),fe(E,{xs:24,sm:12,md:6},void 0,fe(de,{})),fe(E,{xs:24,sm:12,md:6},void 0,fe(he,{})));var ye=()=>pe,me=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();const{Content:ve}=i.a,ge=c()(ve).withConfig({displayName:"mnist-content__ContentContainer"})(["max-width:880px;margin:0 auto;"]);var _e=me(a.a,{},void 0,me(ge,{},void 0,me(G,{}),me(q,{}),me(ye,{})));var Se=()=>_e,De=(n("2oDE"),n("CtXQ")),Ee=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();const{Footer:be}=i.a,Ie=c()(De.a).withConfig({displayName:"mnist-footer__IconFooter"})(["margin-right:3px;font-size:15px;"]),Oe=c.a.p.withConfig({displayName:"mnist-footer__PFooter"})(["font-size:8px;text-align:center;"]),we=c.a.a.withConfig({displayName:"mnist-footer__AFooter"})(["color:inherit;"]);var Te=Ee(we,{href:"https://github.com/ixartz/handwritten-digit-recognition-tensorflowjs",target:"_blank",rel:"noreferrer noopener"},void 0,Ee(Ie,{type:"github"})),xe=Ee("a",{href:"https://blog.ixartz.com/",target:"_blank",rel:"noopener"},void 0,"Ixartz");var Ce=()=>Ee(be,{},void 0,Ee(Oe,{},void 0,Te,"This page is made with Tensorflow.js, Mnist dataset, React, Redux, Redux-Saga, Babel, Webpack, Styled-components, Eslint, Prettier and Ant Design - Author:"," ",xe)),Ae=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();const{Header:Ne}=i.a,Re=c.a.h1.withConfig({displayName:"mnist-header__H1"})(["color:white;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"]);var Pe=Ae(c()(Ne).withConfig({displayName:"mnist-header__WhiteHeader"})(["background:dodgerblue;margin-bottom:20px;"]),{},void 0,Ae(Re,{},void 0,"Digit Recognition with Tensorflow.js and React"));var je=()=>Pe,ke=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}(),Le=ke("div",{},void 0,ke(i.a,{},void 0,ke(je,{}),ke(Se,{}),ke(Ce,{})));t.a=(()=>Le)},Dtiu:function(e,t){e.exports=styled},HTZB:function(e,t){e.exports=BizCharts},QWBH:function(e,t,n){"use strict";n.d(t,"a",function(){return i});class i{constructor(e){this.xmin=e.width,this.xmax=-1,this.ymin=e.height,this.ymax=-1}computeWidth(){return this.xmax-this.xmin+1}computeHeight(){return this.ymax-this.ymin+1}}},Re2a:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"b",function(){return o}),n.d(t,"e",function(){return a}),n.d(t,"h",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"g",function(){return l}),n.d(t,"f",function(){return d});const i={INIT:"INIT",LOAD_PRETRAINED_MODEL_SUCCEEDED:"LOAD_PRETRAINED_MODEL_SUCCEEDED",LOAD_AND_TRAIN_MNIST_REQUESTED:"LOAD_AND_TRAIN_MNIST_REQUESTED",LOADING_MNIST:"LOADING_MNIST",TRAINING_MNIST:"TRAINING_MNIST",LOAD_AND_TRAIN_MNIST_SUCCEEDED:"LOAD_AND_TRAIN_MNIST_SUCCEEDED",PREDICT_REQUESTED:"PREDICT_REQUESTED",PREDICT_SUCCEEDED:"PREDICT_SUCCEEDED"},r=()=>({type:i.LOAD_PRETRAINED_MODEL_SUCCEEDED}),o=()=>({type:i.LOAD_AND_TRAIN_MNIST_REQUESTED}),a=()=>({type:i.LOADING_MNIST}),s=()=>({type:i.TRAINING_MNIST}),c=()=>({type:i.LOAD_AND_TRAIN_MNIST_SUCCEEDED}),l=e=>({type:i.PREDICT_REQUESTED,image:e}),d=e=>({type:i.PREDICT_SUCCEEDED,prediction:e})},cDcd:function(e,t){e.exports=React},cXEB:function(e,t,n){"use strict";var i=n("rKB8"),r=n("/CF2"),o=n("1fKG"),a=n.n(o);const s="ADD_LOSS_POINT",c="ADD_ACCURACY_POINT",l="RESET_CHART",d=(e,t)=>({type:s,pt:{batch:e,loss:t}}),u=(e,t)=>({type:c,pt:{batch:e,accuracy:t}}),h=()=>({type:l});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};const p={loss:[],accuracy:[]};var y=(e=p,t)=>{switch(t.type){case s:return f({},e,{loss:[...e.loss,t.pt]});case c:return f({},e,{accuracy:[...e.accuracy,t.pt]});case l:return p;default:return e}},m=n("65Xs"),v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};const g={isDrawing:!1,isEndStroke:!1,strokes:[]};var _=(e=g,t)=>{switch(t.type){case m.a.ADD_STROKE:return v({},e,{isDrawing:!0,isEndStroke:!1,strokes:[...e.strokes,[t.pos]]});case m.a.ADD_STROKE_POS:return v({},e,{strokes:[...e.strokes.slice(0,e.strokes.length-1),[...e.strokes[e.strokes.length-1],t.pos]]});case m.a.END_STROKE:return v({},e,{isDrawing:!1,isEndStroke:!0});case m.a.RESET_DRAWING:return g;default:return e}},S=n("Re2a"),D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};const E={status:S.a.INIT,retrainStatus:S.a.INIT};var b=(e=E,t)=>{switch(t.type){case S.a.LOAD_PRETRAINED_MODEL_SUCCEEDED:return D({},e,{status:S.a.LOAD_PRETRAINED_MODEL_SUCCEEDED});case S.a.LOADING_MNIST:case S.a.TRAINING_MNIST:case S.a.LOAD_AND_TRAIN_MNIST_SUCCEEDED:return D({},e,{retrainStatus:t.type});case S.a.PREDICT_SUCCEEDED:return D({},e,{prediction:t.prediction});default:return e}},I=n("s5aF"),O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};var w=(e={},t)=>{switch(t.type){case I.a.DISPLAY_BOUNDING_BOX:return O({},e,{imageUrl:t.imageUrl,rect:t.rect});case I.a.DISPLAY_CROPPED_BOX:return O({},e,{croppedUrl:t.croppedUrl});case I.a.DISPLAY_CENTERED_BOX:return O({},e,{centeredUrl:t.centeredUrl});case I.a.DISPLAY_NORMALIZED_BOX:return O({},e,{normalizedUrl:t.normalizedUrl});default:return e}},T=Object(i.combineReducers)({drawing:_,pipeline:w,mnist:b,chart:y}),x=n("oZtI"),C=n("uZTb");class A{initializeModel(e){this.data=e,this.model=C.sequential(),this.model.add(C.layers.conv2d({inputShape:[28,28,1],kernelSize:5,filters:8,strides:1,activation:"relu",kernelInitializer:"varianceScaling"})),this.model.add(C.layers.maxPooling2d({poolSize:[2,2],strides:[2,2]})),this.model.add(C.layers.conv2d({kernelSize:5,filters:16,strides:1,activation:"relu",kernelInitializer:"varianceScaling"})),this.model.add(C.layers.maxPooling2d({poolSize:[2,2],strides:[2,2]})),this.model.add(C.layers.flatten()),this.model.add(C.layers.dense({units:10,kernelInitializer:"varianceScaling",activation:"softmax"})),this.compile()}compile(){const e=C.train.sgd(A.LEARNING_RATE);this.model.compile({optimizer:e,loss:"categoricalCrossentropy",metrics:["accuracy"]})}*loadModel(){const{host:e,protocol:t}=window.location;this.model=yield C.loadModel(`${t}//${e}/${A.CLASSIFIER_FOLDER}/${A.CLASSIFIER_NAME}.json`),this.compile()}getTrainBatch(e){const t=this.data.nextTrainBatch(A.BATCH_SIZE);let n;if(t.xs=t.xs.reshape([A.BATCH_SIZE,28,28,1]),e%A.TEST_ITERATION_FREQUENCY==0){const e=this.data.nextTrainBatch(A.TEST_BATCH_SIZE);n=[e.xs.reshape([A.TEST_BATCH_SIZE,28,28,1]),e.labels]}return[t,n]}*train(e=!1){for(let e=0;e<A.TRAIN_BATCHES;e+=1){const[t,n]=C.tidy(()=>this.getTrainBatch(e)),i=yield this.model.fit(t.xs,t.labels,{batchSize:A.BATCH_SIZE,validationData:n,epochs:1}),r=i.history.loss[0],o=i.history.acc[0];yield Object(x.e)(d(e,r)),null!=n&&(yield Object(x.e)(u(e,o))),C.dispose([t,n]),yield C.nextFrame()}e&&(yield this.model.save(`downloads://${A.CLASSIFIER_NAME}`))}predict(e){return C.tidy(()=>{const t=this.model.predict(e);return Array.from(t.argMax(1).dataSync())[0]})}}A.TRAIN_BATCHES=150,A.BATCH_SIZE=64,A.TEST_ITERATION_FREQUENCY=5,A.TEST_BATCH_SIZE=1e3,A.LEARNING_RATE=.15,A.CLASSIFIER_FOLDER="classifiers",A.CLASSIFIER_NAME="model";const N=784,R=10,P=65e3,j=55e3,k=P-j,L="https://storage.googleapis.com/learnjs-data/model-builder/mnist_images.png",M="https://storage.googleapis.com/learnjs-data/model-builder/mnist_labels_uint8";class U{constructor(){this.load=(async()=>{const e=new Image,t=document.createElement("canvas"),n=t.getContext("2d"),i=new Promise((i,r)=>{e.crossOrigin="",e.onload=(()=>{e.width=e.naturalWidth,e.height=e.naturalHeight;const r=new ArrayBuffer(P*N*4);t.width=e.width,t.height=5e3;for(let i=0;i<P/5e3;i++){const o=new Float32Array(r,i*N*5e3*4,5e3*N);n.drawImage(e,0,5e3*i,e.width,5e3,0,0,e.width,5e3);const a=n.getImageData(0,0,t.width,t.height);for(let e=0;e<a.data.length/4;e++)o[e]=a.data[4*e]/255}this.datasetImages=new Float32Array(r),i()}),e.src=L}),r=fetch(M),[o,a]=await Promise.all([i,r]);this.datasetLabels=new Uint8Array(await a.arrayBuffer()),this.trainIndices=C.util.createShuffledIndices(j),this.testIndices=C.util.createShuffledIndices(k),this.trainImages=this.datasetImages.slice(0,N*j),this.testImages=this.datasetImages.slice(N*j),this.trainLabels=this.datasetLabels.slice(0,R*j),this.testLabels=this.datasetLabels.slice(R*j)}),this.shuffledTrainIndex=0,this.shuffledTestIndex=0}nextTrainBatch(e){return this.nextBatch(e,[this.trainImages,this.trainLabels],()=>(this.shuffledTrainIndex=(this.shuffledTrainIndex+1)%this.trainIndices.length,this.trainIndices[this.shuffledTrainIndex]))}nextTestBatch(e){return this.nextBatch(e,[this.testImages,this.testLabels],()=>(this.shuffledTestIndex=(this.shuffledTestIndex+1)%this.testIndices.length,this.testIndices[this.shuffledTestIndex]))}nextBatch(e,t,n){const i=new Float32Array(e*N),r=new Uint8Array(e*R);for(let o=0;o<e;o++){const e=n(),a=t[0].slice(e*N,e*N+N);i.set(a,o*N);const s=t[1].slice(e*R,e*R+R);r.set(s,o*R)}return{xs:C.tensor2d(i,[e,N]),labels:C.tensor2d(r,[e,R])}}}var B=n("QWBH");function*$(e){yield Object(x.e)(Object(S.h)());const t=new A;return t.initializeModel(e),yield Object(x.b)(t,t.train),t}function*z(){yield Object(x.e)(Object(S.e)());const e=new U;return yield Object(x.c)(e.load),yield Object(x.c)($,e)}function*X(){const e=new A;return yield Object(x.b)(e,e.loadModel),yield Object(x.e)(Object(S.d)()),e}function*H(e,t){const n=function(e){const t=[],{data:n}=e;for(let i=0;i<e.width*e.height;i+=1){const e=4*i,r=(n[e+0]+n[e+1]+n[e+2])/3/255;t.push(r)}return t}(t),i=C.tensor(n,[1,28,28,1]),r=e.predict(i);yield Object(x.e)(Object(S.f)(r))}function*G(e){let t=e;for(;;){const e=yield Object(x.f)([S.a.PREDICT_REQUESTED,S.a.LOAD_AND_TRAIN_MNIST_REQUESTED]);switch(e.type){case S.a.PREDICT_REQUESTED:yield Object(x.c)(H,t,e.image);break;case S.a.LOAD_AND_TRAIN_MNIST_REQUESTED:yield Object(x.e)(h()),yield Object(x.e)(Object(m.e)()),t=t.data?yield Object(x.c)($,t.data):yield Object(x.c)(z),yield Object(x.e)(Object(S.c)())}}}var F=function*(){const e=yield Object(x.c)(X);yield Object(x.c)(G,e)};function*Y(e){const t=document.createElement("canvas");t.width=280,t.height=280,t.getContext("2d").putImageData(e.image,0,0);const n=function(e){const t=new B.a(e);for(let n=0;n<e.width*e.height;n+=1){const i=4*n;if(e.data[i+0]>0||e.data[i+1]>0||e.data[i+2]>0){const i=n%e.width,r=Math.floor(n/e.width);t.xmin=Math.min(i,t.xmin),t.xmax=Math.max(i,t.xmax),t.ymin=Math.min(r,t.ymin),t.ymax=Math.max(r,t.ymax)}}return t}(e.image);return yield Object(x.e)(Object(I.c)(t.toDataURL(),n)),{canvas:t,rect:n}}function*K(e,t){const n=document.createElement("canvas");n.width=200,n.height=200;const i=n.getContext("2d"),r=t.computeWidth(),o=t.computeHeight(),a=200/Math.max(r,o),s={width:r*a,height:o*a};return i.drawImage(e,t.xmin,t.ymin,r,o,0,0,s.width,s.height),yield Object(x.e)(Object(I.e)(n.toDataURL())),{croppedCanvas:n,croppedRectSize:s}}function*W(e,t){const n=document.createElement("canvas");return n.width=280,n.height=280,n.getContext("2d").drawImage(e,n.width/2-t.width/2,n.height/2-t.height/2),yield Object(x.e)(Object(I.d)(n.toDataURL())),n}function*Q(e){const t=document.createElement("canvas");return t.width=28,t.height=28,t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),yield Object(x.e)(Object(I.f)(t.toDataURL())),t}function*Z(e){const t=e.getContext("2d");yield Object(x.e)(Object(S.g)(t.getImageData(0,0,e.width,e.height)))}function*J(e){const{canvas:t,rect:n}=yield Object(x.c)(Y,e),{croppedCanvas:i,croppedRectSize:r}=yield Object(x.c)(K,t,n),o=yield Object(x.c)(W,i,r),a=yield Object(x.c)(Q,o);yield Object(x.c)(Z,a)}var q=function*(){yield Object(x.g)(I.a.INPUT,J)};function*V(){yield Object(x.a)([Object(x.d)(F),Object(x.d)(q)])}function ee(e){const t=Object(r.composeWithDevTools)({}),n=a()(),o=[n],s=Object(i.createStore)(T,e,t(Object(i.applyMiddleware)(...o)));return n.run(V),s}n.d(t,"a",function(){return ee})},faye:function(e,t){e.exports=ReactDOM},h74D:function(e,t){e.exports=ReactRedux},pL5B:function(e,t,n){"use strict";(function(e){var i=n("cDcd"),r=n.n(i),o=n("0cfB"),a=n("h74D"),s=n("cXEB"),c=n("8XyM"),l=function(){var e="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(t,n,i,r){var o=t&&t.defaultProps,a=arguments.length-3;if(n||0===a||(n={}),n&&o)for(var s in o)void 0===n[s]&&(n[s]=o[s]);else n||(n=o||{});if(1===a)n.children=r;else if(a>1){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+3];n.children=c}return{$$typeof:e,type:t,key:void 0===i?null:""+i,ref:null,props:n,_owner:null}}}();window.BizCharts.track(!1);var d=l(c.a,{});t.a=Object(o.hot)(e)(class extends r.a.Component{constructor(e){super(e),this.store=Object(s.a)()}render(){return l(a.Provider,{store:this.store},void 0,d)}})}).call(this,n("3UD+")(e))},rKB8:function(e,t){e.exports=Redux},s5aF:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"e",function(){return a}),n.d(t,"d",function(){return s}),n.d(t,"f",function(){return c});const i={INPUT:"INPUT",DISPLAY_BOUNDING_BOX:"DISPLAY_BOUNDING_BOX",DISPLAY_CROPPED_BOX:"DISPLAY_CROPPED_BOX",DISPLAY_CENTERED_BOX:"DISPLAY_CENTERED_BOX",DISPLAY_NORMALIZED_BOX:"DISPLAY_NORMALIZED_BOX"},r=e=>({type:i.INPUT,image:e}),o=(e,t)=>({type:i.DISPLAY_BOUNDING_BOX,imageUrl:e,rect:t}),a=e=>({type:i.DISPLAY_CROPPED_BOX,croppedUrl:e}),s=e=>({type:i.DISPLAY_CENTERED_BOX,centeredUrl:e}),c=e=>({type:i.DISPLAY_NORMALIZED_BOX,normalizedUrl:e})},uZTb:function(e,t){e.exports=tf}},[["7pVq",2,1]]]);